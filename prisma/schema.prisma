generator client {
  provider = "prisma-client-js"
  version  = "6.18.0"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String?
  role          String    @default("PLAYER")
  firstName     String?
  lastName      String?
  isActive      Boolean   @default(true)
  emailVerified Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
  lastLoginAt   DateTime?
  loginIp       String?
  userAgent     String?
  name          String?

  @@map("User")
}

model LoginLog {
  id            String   @id @default(cuid())
  userId        String
  email         String
  role          String
  ipAddress     String?
  userAgent     String?
  success       Boolean  @default(true)
  failureReason String?
  createdAt     DateTime @default(now())

  @@map("LoginLog")
}

model chat_messages {
  id          String     @id
  roomId      String
  senderId    String
  content     String
  messageType String     @default("text")
  fileUrl     String?
  fileName    String?
  fileType    String?
  fileSize    Int?
  replyToId   String?
  editedAt    DateTime?
  deletedAt   DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  chat_rooms  chat_rooms @relation(fields: [roomId], references: [id], onDelete: Cascade)
  users       users      @relation(fields: [senderId], references: [id], onDelete: Cascade)
}

model chat_room_participants {
  id         String     @id
  roomId     String
  userId     String
  role       String     @default("member")
  joinedAt   DateTime   @default(now())
  leftAt     DateTime?
  isActive   Boolean    @default(true)
  chat_rooms chat_rooms @relation(fields: [roomId], references: [id], onDelete: Cascade)
  users      users      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model chat_rooms {
  id                     String                   @id
  name                   String
  description            String?
  createdBy              String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  chat_messages          chat_messages[]
  chat_room_participants chat_room_participants[]
  users                  users                    @relation(fields: [createdBy], references: [id], onDelete: Cascade)
}

model coach_note_staff_access {
  id          String      @id
  noteId      String
  staffId     String
  canView     Boolean     @default(true)
  canEdit     Boolean     @default(false)
  createdAt   DateTime    @default(now())
  coach_notes coach_notes @relation(fields: [noteId], references: [id], onDelete: Cascade)
  staff       staff       @relation(fields: [staffId], references: [id], onDelete: Cascade)
}

model coach_notes {
  id                      String                    @id
  title                   String
  content                 String
  isPinned                Boolean                   @default(false)
  authorId                String
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  coach_note_staff_access coach_note_staff_access[]
  users                   users                     @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

model coaches {
  id                 String    @id
  userId             String    @unique
  firstName          String
  lastName           String
  email              String?
  phone              String?
  dateOfBirth        DateTime?
  avatar             String?
  coachType          String?
  specialization     String?
  experience         Int?
  certifications     String?
  dailyMorningReport Boolean   @default(false)
  morningReportTime  String?   @default("08:00")
  dailyEveningReport Boolean   @default(false)
  eveningReportTime  String?   @default("18:00")
  eventReports       Boolean   @default(true)
  eventReportDelay   String?   @default("1.5 hours")
  weeklyReport       Boolean   @default(false)
  weeklyReportDay    String?   @default("Monday")
  weeklyReportTime   String?   @default("08:00")
  monthlyReport      Boolean   @default(false)
  monthlyReportTime  String?   @default("08:00")
  isActive           Boolean   @default(true)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  users              users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  events             events[]
}

model daily_player_analytics {
  id        String   @id
  playerId  String
  date      DateTime
  status    String
  notes     String?
  createdAt DateTime @default(now())
  players   players  @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

model daily_player_notes {
  id        String   @id
  playerId  String
  date      DateTime
  reason    String?
  notes     String?
  createdAt DateTime @default(now())
  players   players  @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

model event_media {
  id         String   @id
  eventId    String
  fileName   String
  fileUrl    String
  fileType   String
  fileSize   Int
  uploadedAt DateTime @default(now())
  events     events   @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model event_participants {
  id        String   @id
  eventId   String
  playerId  String?
  staffId   String?
  role      String?
  createdAt DateTime @default(now())
  events    events   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  players   players? @relation(fields: [playerId], references: [id], onDelete: Cascade)
  staff     staff?   @relation(fields: [staffId], references: [id], onDelete: Cascade)
}

model events {
  id                    String               @id
  title                 String
  description           String?
  type                  EventType
  startTime             DateTime
  endTime               DateTime
  locationId            String?
  teamId                String?
  coachId               String?
  isRecurring           Boolean              @default(false)
  recurrenceRule        String?
  isAllDay              Boolean              @default(false)
  color                 String?
  icon                  String?
  allowPlayerCreation   Boolean              @default(false)
  allowPlayerReschedule Boolean              @default(false)
  createdAt             DateTime             @default(now())
  updatedAt             DateTime
  event_media           event_media[]
  event_participants    event_participants[]
  coaches               coaches?             @relation(fields: [coachId], references: [id])
  teams                 teams?               @relation(fields: [teamId], references: [id])
}

model file_analytics {
  id        String   @id
  reportId  String
  userId    String
  action    String
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  reports   reports  @relation(fields: [reportId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model login_logs {
  id            String   @id
  userId        String
  email         String
  role          UserRole
  firstName     String
  lastName      String
  avatar        String?
  ipAddress     String
  userAgent     String
  location      String?
  success       Boolean
  failureReason String?
  createdAt     DateTime @default(now())
  users         users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model notifications {
  id        String           @id
  userId    String
  title     String
  message   String
  type      NotificationType @default(GENERAL)
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  users     users            @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model player_availability {
  id        String       @id
  playerId  String
  date      DateTime
  status    PlayerStatus
  notes     String?
  createdAt DateTime     @default(now())
  updatedAt DateTime
  players   players      @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([playerId, date])
}

model player_media {
  id           String   @id
  playerId     String
  fileName     String
  fileUrl      String
  fileType     String
  fileSize     Int
  tags         String?
  thumbnailUrl String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  players      players  @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

model player_notes {
  id        String   @id
  playerId  String
  title     String
  content   String
  type      NoteType @default(GENERAL)
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime
  players   players  @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

model player_report_folders {
  id                          String                        @id
  name                        String
  description                 String?
  parentId                    String?
  createdBy                   String
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  isActive                    Boolean                       @default(true)
  player_report_folders       player_report_folders?        @relation("player_report_foldersToplayer_report_folders", fields: [parentId], references: [id], onDelete: Cascade)
  other_player_report_folders player_report_folders[]       @relation("player_report_foldersToplayer_report_folders")
  player_report_player_access player_report_player_access[]
  player_report_visibility    player_report_visibility[]
  player_reports              player_reports[]
}

model player_report_player_access {
  id                    String                 @id
  reportId              String?
  folderId              String?
  playerId              String
  canView               Boolean                @default(true)
  canEdit               Boolean                @default(false)
  canDelete             Boolean                @default(false)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  player_report_folders player_report_folders? @relation(fields: [folderId], references: [id], onDelete: Cascade)
  players               players                @relation(fields: [playerId], references: [id], onDelete: Cascade)
  player_reports        player_reports?        @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model player_report_visibility {
  id                    String                 @id
  reportId              String?
  folderId              String?
  userId                String
  canView               Boolean                @default(true)
  canEdit               Boolean                @default(false)
  canDelete             Boolean                @default(false)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  player_report_folders player_report_folders? @relation(fields: [folderId], references: [id], onDelete: Cascade)
  player_reports        player_reports?        @relation(fields: [reportId], references: [id], onDelete: Cascade)
  users                 users                  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model player_reports {
  id                          String                        @id
  title                       String
  description                 String?
  folderId                    String?
  fileName                    String
  fileType                    String
  fileSize                    Int
  fileUrl                     String
  thumbnailUrl                String?
  createdBy                   String
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  isActive                    Boolean                       @default(true)
  player_report_player_access player_report_player_access[]
  player_report_visibility    player_report_visibility[]
  player_report_folders       player_report_folders?        @relation(fields: [folderId], references: [id], onDelete: Cascade)
}

model players {
  id                          String                        @id
  userId                      String                        @unique
  firstName                   String
  lastName                    String
  email                       String?
  phone                       String?
  dateOfBirth                 DateTime?
  avatar                      String?
  position                    String?
  jerseyNumber                Int?
  height                      Float?
  weight                      Float?
  preferredFoot               String?
  nationality                 String?
  currentAddress              String?
  birthCity                   String?
  birthCountry                String?
  bloodType                   String?
  emergencyContact            String?
  medicalNotes                String?
  teamId                      String?
  dateJoined                  DateTime?
  status                      PlayerStatus                  @default(ACTIVE)
  matchDayTag                 String?
  isActive                    Boolean                       @default(true)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  daily_player_analytics      daily_player_analytics[]
  daily_player_notes          daily_player_notes[]
  event_participants          event_participants[]
  player_availability         player_availability[]
  player_media                player_media[]
  player_notes                player_notes[]
  player_report_player_access player_report_player_access[]
  users                       users                         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model report_folders {
  id                   String              @id
  name                 String
  description          String?
  parentId             String?
  createdBy            String
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  isActive             Boolean             @default(true)
  report_folders       report_folders?     @relation("report_foldersToreport_folders", fields: [parentId], references: [id], onDelete: Cascade)
  other_report_folders report_folders[]    @relation("report_foldersToreport_folders")
  report_visibility    report_visibility[]
  reports              reports[]
}

model report_visibility {
  id             String          @id
  reportId       String?
  folderId       String?
  userId         String
  canView        Boolean         @default(true)
  canEdit        Boolean         @default(false)
  canDelete      Boolean         @default(false)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  report_folders report_folders? @relation(fields: [folderId], references: [id], onDelete: Cascade)
  reports        reports?        @relation(fields: [reportId], references: [id], onDelete: Cascade)
  users          users           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model reports {
  id                String              @id
  title             String
  description       String?
  folderId          String?
  fileName          String
  fileType          String
  fileSize          Int
  fileUrl           String
  thumbnailUrl      String?
  createdBy         String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  isActive          Boolean             @default(true)
  file_analytics    file_analytics[]
  report_visibility report_visibility[]
  report_folders    report_folders?     @relation(fields: [folderId], references: [id], onDelete: Cascade)
}

model sessions {
  id        String   @id
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model staff {
  id                      String                    @id
  userId                  String                    @unique
  firstName               String
  lastName                String
  email                   String?
  phone                   String?
  dateOfBirth             DateTime?
  avatar                  String?
  position                String?
  department              String?
  experience              Int?
  certifications          String?
  canCreateEvents         Boolean                   @default(false)
  canEditEvents           Boolean                   @default(false)
  canDeleteEvents         Boolean                   @default(false)
  canViewAllPlayers       Boolean                   @default(true)
  canEditPlayers          Boolean                   @default(false)
  canDeletePlayers        Boolean                   @default(false)
  canAddPlayerMedia       Boolean                   @default(false)
  canEditPlayerMedia      Boolean                   @default(false)
  canDeletePlayerMedia    Boolean                   @default(false)
  canAddPlayerNotes       Boolean                   @default(false)
  canEditPlayerNotes      Boolean                   @default(false)
  canDeletePlayerNotes    Boolean                   @default(false)
  canViewCalendar         Boolean                   @default(true)
  canViewDashboard        Boolean                   @default(true)
  canManageStaff          Boolean                   @default(false)
  canViewReports          Boolean                   @default(false)
  isActive                Boolean                   @default(true)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  coach_note_staff_access coach_note_staff_access[]
  event_participants      event_participants[]
  users                   users                     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model teams {
  id          String   @id
  name        String
  logo        String?
  color       String?
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  events      events[]
}

model users {
  id                       String                     @id
  email                    String                     @unique
  password                 String?
  role                     UserRole                   @default(PLAYER)
  firstName                String
  lastName                 String
  avatar                   String?
  isActive                 Boolean                    @default(true)
  emailVerified            Boolean                    @default(false)
  lastLoginAt              DateTime?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  chat_messages            chat_messages[]
  chat_room_participants   chat_room_participants[]
  chat_rooms               chat_rooms[]
  coach_notes              coach_notes[]
  coaches                  coaches?
  file_analytics           file_analytics[]
  login_logs               login_logs[]
  notifications            notifications[]
  player_report_visibility player_report_visibility[]
  players                  players?
  report_visibility        report_visibility[]
  sessions                 sessions[]
  staff                    staff?
  wellness_responses       Response[]                 // Wellness survey responses
}

enum UserRole {
  ADMIN
  COACH
  PLAYER
  STAFF
}

enum PlayerStatus {
  FULLY_AVAILABLE
  PARTIAL_TRAINING
  PARTIAL_TEAM_INDIVIDUAL
  REHAB_INDIVIDUAL
  NOT_AVAILABLE_INJURY
  PARTIAL_ILLNESS
  NOT_AVAILABLE_ILLNESS
  INDIVIDUAL_WORK
  RECOVERY
  NOT_AVAILABLE_OTHER
  DAY_OFF
  NATIONAL_TEAM
  PHYSIO_THERAPY
  ACTIVE
  INJURED
  SUSPENDED
  INACTIVE
  RETIRED
}

enum EventType {
  TRAINING
  MATCH
  MEETING
  MEDICAL
  RECOVERY
  MEAL
  COFFEE
  OTHER
}

enum NotificationType {
  EVENT_REMINDER
  MEDIA_UPLOADED
  NOTE_ADDED
  WELLNESS_ALERT
  ATTENDANCE_REMINDER
  GENERAL
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
  INJURED
}

enum DocumentType {
  PDF
  IMAGE
  VIDEO
  AUDIO
  OTHER
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum MediaType {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  OTHER
}

enum NoteType {
  GENERAL
  MEDICAL
  PERFORMANCE
  TACTICAL
  PERSONAL
}

enum WellnessDataType {
  WEIGHT
  HEIGHT
  BODY_FAT
  MUSCLE_MASS
  HEART_RATE
  BLOOD_PRESSURE
  SLEEP_HOURS
  STRESS_LEVEL
  MOOD
  ENERGY_LEVEL
  OTHER
}

// Wellness Survey Models
model Survey {
  id          String   @id @default(cuid())
  title       String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String   // User ID who created the survey
  
  // Recurring survey fields
  isRecurring     Boolean  @default(false)
  startDate       DateTime?
  endDate         DateTime?
  dailyStartTime  String?  // Format: "06:00"
  dailyEndTime    String?  // Format: "11:00"
  timezone        String   @default("Europe/Belgrade")
  
  questions   Question[]
  responses   Response[]
  
  @@map("surveys")
}

model Question {
  id          String       @id @default(cuid())
  surveyId    String
  text        String
  type        QuestionType
  options     String?      // JSON string for multiple choice options
  required    Boolean      @default(true)
  order       Int          @default(0)
  createdAt   DateTime     @default(now())
  
  survey      Survey       @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  answers     Answer[]
  
  @@map("questions")
}

model Response {
  id          String   @id @default(cuid())
  surveyId    String
  userId      String?  // Link to User (instead of Player)
  playerName  String?  // Optional player identifier (for anonymous responses)
  playerEmail String?  // Optional player email (for anonymous responses)
  submittedAt DateTime @default(now())
  
  survey      Survey   @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  user        users?   @relation(fields: [userId], references: [id], onDelete: SetNull)
  answers     Answer[]
  
  @@map("responses")
}

model Answer {
  id         String @id @default(cuid())
  responseId String
  questionId String
  value      String // Store answer as string (can be JSON for complex answers)
  
  response   Response @relation(fields: [responseId], references: [id], onDelete: Cascade)
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  
  @@unique([responseId, questionId])
  @@map("answers")
}

model KioskSettings {
  id        String   @id @default(cuid())
  password  String   @default("")
  isEnabled Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("kiosk_settings")
}

enum QuestionType {
  TEXT
  NUMBER
  EMAIL
  SELECT
  MULTIPLE_SELECT
  SCALE
  BOOLEAN
  BODY_MAP
  RATING_SCALE
  RPE
  SLIDER
  TIME
}
